{% extends "base.html" %}

{% block content %}
<div class="row form-body">
  <h2 class="page-heading">{{ title }}</h2>

  {% for ns in pageData %}
    {% if ns.configmaps | length > 0 %}
    <div class="high-block config-review">
      <h5>命名空间：{{ ns.namespace }}</h5>
      <div class="panel-group" id="configAccordion" role="tablist" aria-multiselectable="true">
        <div class="panel panel-default">
          {% for conf in ns.configmaps %}
          <div class="config-item-group">
            <div class="panel-heading" role="tab">
              {# <label class="pull-right" onclick="setup.config_item_checked_all()"> #}
              {#   <input type="checkbox" /> #}
              {#   已检查 #}
              {# </label> #}
              <h4 class="panel-title">
                <i class="icon-right"></i>
                <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse{{ conf.key }}" aria-expanded="true" aria-controls="collapse{{ conf.key }}">
                  {{ conf.key }}（
                  {% for serviceName in conf.services %}
                    {{ serviceName }}{{ '、' if not loop.last }}
                  {% endfor %}）
                </a>
              </h4>
            </div>
            <div id="collapse{{ conf.key }}" class="panel-collapse collapse" role="tabpanel">
              <div class="panel-body">
                <textarea id="txt{{ conf.key }}" data-key="{{ conf.key }}" data-format="{{ conf.format }}" onchange="setup.format_validate(this)" class="text-left monospaced">{{ conf.content }}</textarea>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
    {% endif %}
  {% endfor %}
</div>

<div class="row form-body">
  <div class="text-right">
    <label id="chk_config" onclick="setup.config_item_checked_all()">
      <input type="checkbox" />
      已检查全部配置信息
    </label>
    <button id="btnConfigmapCreate" {{ "disabled" if not __common__.debug }} class="btn btn-danger" onclick="setup.configmap_create()">生成配置</button>
  </div>
</div>

<script text="text/javascript">

  $().ready(function(){
    $('#configAccordion').on('hidden.bs.collapse', function(ev){
      var jqTarget = $(ev.target);
      var jqHeading = jqTarget.prev();

      jqHeading.addClass('in');
      jqHeading.find("h4 > i").removeClass('icon-Retract').addClass('icon-right');

      return true;
    }).on('shown.bs.collapse', function(ev){
      var jqTarget = $(ev.target);
      var jqHeading = jqTarget.prev();

      jqHeading.addClass('in');
      jqHeading.find("h4 > i").removeClass('icon-right').addClass('icon-Retract');

      return true;
    });
  });

</script>

{% endblock %}
