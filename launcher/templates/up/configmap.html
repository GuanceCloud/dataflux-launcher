{% extends "base.html" %}

{% block content %}

<div class="row form-body">
  <h2 class="page-heading">{{ title }}</h2>

  {% for ns in pageData %}
  <div class="high-block">
    <h5>命名空间：{{ ns.namespace }}</h5>
    <div class="panel-group configAccordion" role="tablist" aria-multiselectable="true">
      <div class="panel panel-default config-review">
        {% for conf in ns.configmaps %}
        <div class="panel-heading" role="tab">
          <h4 class="panel-title">
            {% if conf.updates | length > 0 %}
            <span class="text-danger pull-right">配置有更新!!!</span>
            {% endif %}

            <i class="icon-right"></i>
            <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse{{ conf.key }}" aria-expanded="true" aria-controls="collapse{{ conf.key }}">
              {{ conf.key }}（
              {% for serviceName in conf.services %}
                {{ serviceName }}{{ '、' if not loop.last }}
              {% endfor %}）
            </a>
          </h4>
        </div>
        <div id="collapse{{ conf.key }}" class="panel-collapse collapse" role="tabpanel">
          <div class="panel-body">
            <div class="config-update-left">

              {% if conf.updates | length == 0 %}
              <div class="high-block-sm">
                <h5># 无配置更新，但也可以在右侧修改配置</h5>
              </div>
              {% endif %}

              {% for up in conf.updates %}
              <div class="high-block-sm">
                <h5># 版本：{{ up.seq }}</h5>
                <pre>{{ up.content }}</pre>
              </div>
              {% endfor %}

            </div>
            <div class="config-update-right">
              <textarea id="txt{{ conf.key }}" data-key="{{ conf.key }}" class="text-left monospaced">{{ conf.content }}</textarea>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<div class="row form-body">
    <div class="form-group">
      <label class="col-sm-2 control-label">&nbsp;</label>
      <div class="col-sm-10">
        <button id="btnConfigmapUpdate"  class="btn btn-primary" onclick="setup.configmap_update()">
            确认升级
          </button>
          <a id="btnNext" class="btn btn-default" href="/up/database">
            不更新，直接下一步
          </a>
      </div>
    </div>

  </div>
</div>


<script text="text/javascript">

  $().ready(function(){
    $('.configAccordion').on('hidden.bs.collapse', function(ev){
      var jqTarget = $(ev.target);
      var jqHeading = jqTarget.prev();

      jqHeading.addClass('in');
      jqHeading.find("h4 > i").removeClass('icon-Retract').addClass('icon-right');

      return true;
    }).on('shown.bs.collapse', function(ev){
      var jqTarget = $(ev.target);
      var jqHeading = jqTarget.prev();

      jqHeading.addClass('in');
      jqHeading.find("h4 > i").removeClass('icon-right').addClass('icon-Retract');

      return true;
    });
  });

</script>

{% endblock %}


