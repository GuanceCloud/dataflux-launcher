upgradeInfo:
  - seq: 1
    config: |-
      当前版本的升级功能，需要 Elasticsearch 的支持，继续下一步之前，请先准备好 Elasticsearch 实例，并在右上角的 **Elasticsearch** 菜单中，按以下模板，增加 Elasticsearch 的实例配置信息：

      ```yaml
      ssl:  True
      host: 192.168.0.1
      port: 9200
      user: elastic
      password: 123456
      ```

      在升级完成，并全部服务启动之后，进入 launcher 容器，执行以下命令，初始化所有工作空间的 ES RP 信息：

      ```shell
      curl http://inner.forethought-core:5000/api/v1/inner/es/init -H "Content-Type:application/json" -X POST
      ```

  - seq: 2
    config: |-
      升级完成后，执行以下命令刷 ES 索引，禁用日期格式字符串自动转换成日期类型，执行前替换 Elasticsearch host、user、password：

      ```shell
      curl -XPOST "http://es-cn-stxxxx.elasticsearch.aliyuncs.com:9200/wksp_*/_mapping" -u user:password -H 'Content-Type: application/json' -d'{ "date_detection": false }'
      ```

      在升级完成，并全部服务启动之后，进入 launcher 容器，执行以下命令，重新初始化 ES 模板：

      ```shell
      curl http://inner.forethought-core:5000/api/v1/inner/es/init -H "Content-Type:application/json" -X POST
      ```

  - seq: 3
    config: |-
      升级前，在右上角的配置 -> 其他 -> tls 节点下面增加：tlsDisabled: false，启用 TLS 的配置项，默认为启用，可以不添加此配置项。
      ```
        tls:
          tlsDisabled: false
      ```

      升级完成后，进入集群 launcher 容器，依次执行以下两条终端命令：

      执行以下命令，更新概览图指标卡标题：

      ```shell
      curl -H "Content-Type:application/json" -X POST 'http://inner.forethought-core:5000/api/v1/inner/upgrade/fix_data?script_name=fix_singlestat_chart_name'
      ```

      执行以下命令，更新 ES 索引模板：

      ```shell
      curl -H "Content-Type:application/json" -X POST 'http://inner.forethought-core:5000/api/v1/inner/es/init'
      ```

  - seq: 4
    config: |-
      * 此版本包含 Func 平台的重大升级，需要迁移数据库，**所有必须先备份好数据所有数据库**
      * 升级到此版本前，必须先升级到此版本的前一个版本： **1.9.48**，不可从更早的版本升级到此版本
      * 升级前，在右上角的配置 **MySQL** 配置 中，将 **func** 节点名称改为 **dataflux-func**
      * 升级前，先进行 Func 平台数据库的手工数据迁移，进入 Launcher 容器，执行以下命令：

          1. 进入 launcher/resource/v1/ddl/ 目录：

              ```
              cd /config/cloudcare-forethought-setup/launcher/resource/v1/ddl/
              ```

          2. 执行以下命令，迁移 Func 平台的数据库，注意替换命令中的参数，参数为 MySQL 数据库信息，使用 MySQL 的管理员账号密码，Database 为 Func 平台的数据库名称，一般是 df_func：
            
              ```
              python migrate_1_x.py --host <Host> --port <Port> --user <User> --password <Password> --database <Database>
              ```
